args:
- --set stream.midstream=true
- --set stream.async-oneside=false

pcap: ../stream-async-6063-srv-01/http-request-header-async-srv.pcap

checks:
  - filter:
      count: 2
      match:
        event_type: alert
        src_port: 80
  - filter:
      count: 1
      match:
        event_type: alert
        src_port: 80
        alert.signature_id: 2
  - filter:
      count: 1
      match:
        event_type: alert
        src_port: 80
        alert.signature_id: 4
  - filter:
      count: 1
      match:
        event_type: http
        dest_port: 80
  - filter:
      count: 1
      match:
        event_type: anomaly
        anomaly.app_proto: http
        anomaly.type: applayer
        anomaly.event: UNABLE_TO_MATCH_RESPONSE_TO_REQUEST
        anomaly.layer: proto_parser
  - filter:
      min-version: 8
      count: 1
      match:
        event_type: flow
        app_proto: http
        proto: TCP
        flow.pkts_toserver: 0
        flow.pkts_toclient: 5
        flow.bytes_toserver: 0
        flow.bytes_toclient: 517
        flow.age: 0
        flow.state: established
        flow.reason: shutdown
        flow.alerted: true
        flow.exception_policy[0].target: "stream_midstream"
        flow.exception_policy[0].policy: "ignore"
        flow.tx_cnt: 1
        tcp.tcp_flags: 1b
        tcp.tcp_flags_tc: 1b
        tcp.tcp_flags_ts: '00'
        tcp.fin: true
        tcp.syn: true
        tcp.psh: true
        tcp.ack: true
        tcp.state: fin_wait1
        tcp.ts_max_regions: 1
        tcp.tc_max_regions: 1
  - filter:
      lt-version: 8
      count: 1
      match:
        event_type: flow
        app_proto: http
        proto: TCP
        flow.pkts_toserver: 0
        flow.pkts_toclient: 5
        flow.bytes_toserver: 0
        flow.bytes_toclient: 517
        flow.age: 0
        flow.state: established
        flow.reason: shutdown
        flow.alerted: true
        tcp.tcp_flags: 1b
        tcp.tcp_flags_tc: 1b
        tcp.tcp_flags_ts: '00'
        tcp.fin: true
        tcp.syn: true
        tcp.psh: true
        tcp.ack: true
        tcp.state: fin_wait1
        tcp.ts_max_regions: 1
        tcp.tc_max_regions: 1
