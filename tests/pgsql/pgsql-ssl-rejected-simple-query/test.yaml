requires:
  # Requires minimum version 7.0
  min-version: 7.0

args:
- -k none

checks:
- filter:
    count: 1
    match:
      dest_ip: 10.16.1.11
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 14
      pgsql.request.message: SSL Request
      pgsql.response.message: SSL Rejected
      pgsql.tx_id: 1
      proto: TCP
      src_ip: 10.16.1.10
      src_port: 40784
- filter:
    count: 1
    match:
      dest_ip: 10.16.1.11
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 14
      pgsql.request.startup_message.protocol_version: '3.0'
      pgsql.request.startup_message.startup_parameters.database: indexer
      pgsql.request.startup_message.startup_parameters.user: indexer
      pgsql.response.authentication_md5_password.payload: \x88'N5
      pgsql.tx_id: 2
      proto: TCP
      src_ip: 10.16.1.10
      src_port: 40784
- filter:
    count: 1
    match:
      dest_ip: 10.16.1.11
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 41
      pgsql.request.message: SSL Request
      pgsql.response.message: SSL Rejected
      pgsql.tx_id: 1
      proto: TCP
      src_ip: 10.16.1.10
      src_port: 40816
- filter:
    count: 1
    match:
      dest_ip: 10.16.1.11
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 41
      pgsql.request.startup_message.protocol_version: '3.0'
      pgsql.request.startup_message.startup_parameters.database: indexer
      pgsql.request.startup_message.startup_parameters.user: indexer
      pgsql.response.authentication_md5_password.payload: "\\x9fi\x1A\\x8e"
      pgsql.tx_id: 2
      proto: TCP
      src_ip: 10.16.1.10
      src_port: 40816
- filter:
    count: 1
    match:
      dest_ip: 10.16.1.11
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 41
      pgsql.request.password_message.payload: md5e4cfa9552468cae5d48ca2822ca36e22
      pgsql.responses[0].authentication_ok.payload: ''
      pgsql.responses[10].parameter_status.name: standard_conforming_strings
      pgsql.responses[10].parameter_status.value: 'on'
      pgsql.responses[11].parameter_status.name: TimeZone
      pgsql.responses[11].parameter_status.value: Etc/UTC
      pgsql.responses[12].backend_key_data.process_id: 61
      pgsql.responses[12].backend_key_data.secret_key: 3152142766
      pgsql.responses[13].ready_for_query.transaction_status: I
      pgsql.responses[1].parameter_status.name: application_name
      pgsql.responses[1].parameter_status.value: psql
      pgsql.responses[2].parameter_status.name: client_encoding
      pgsql.responses[2].parameter_status.value: UTF8
      pgsql.responses[3].parameter_status.name: DateStyle
      pgsql.responses[3].parameter_status.value: ISO, MDY
      pgsql.responses[4].parameter_status.name: integer_datetimes
      pgsql.responses[4].parameter_status.value: 'on'
      pgsql.responses[5].parameter_status.name: IntervalStyle
      pgsql.responses[5].parameter_status.value: postgres
      pgsql.responses[6].parameter_status.name: is_superuser
      pgsql.responses[6].parameter_status.value: 'on'
      pgsql.responses[7].parameter_status.name: server_encoding
      pgsql.responses[7].parameter_status.value: UTF8
      pgsql.responses[8].parameter_status.name: server_version
      pgsql.responses[8].parameter_status.value: 13.0 (Debian 13.0-1.pgdg100+1)
      pgsql.responses[9].parameter_status.name: session_authorization
      pgsql.responses[9].parameter_status.value: indexer
      pgsql.tx_id: 3
      proto: TCP
      src_ip: 10.16.1.10
      src_port: 40816
- filter:
    count: 1
    match:
      dest_ip: 10.16.1.11
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 41
      pgsql.request.simple_query.payload: select * from rules where sid = 2021701;
      pgsql.responses[0].row_description.backend_response: Response Ok
      pgsql.responses[0].row_description.field_count: 10
      pgsql.responses[1].data_row.backend_response: Response Ok
      pgsql.responses[2].data_row.backend_response: Response Ok
      pgsql.responses[3].data_row.backend_response: Response Ok
      pgsql.responses[4].command_completed.payload: "SELECT 3"
      pgsql.responses[5].ready_for_query.transaction_status: I
      pgsql.tx_id: 4
      proto: TCP
      src_ip: 10.16.1.10
      src_port: 40816
- filter:
    count: 1
    match:
      dest_ip: 10.16.1.11
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 41
      pgsql.request.message: termination_message
      pgsql.tx_id: 5
      proto: TCP
      src_ip: 10.16.1.10
      src_port: 40816
- filter:
    count: 1
    match:
      app_proto: pgsql
      dest_ip: 10.16.1.11
      dest_port: 5432
      event_type: flow
      flow.age: 0
      flow.alerted: false
      flow.bytes_toclient: 418
      flow.bytes_toserver: 626
      flow.pkts_toclient: 6
      flow.pkts_toserver: 8
      flow.reason: shutdown
      flow.state: closed
      proto: TCP
      src_ip: 10.16.1.10
      src_port: 40784
      tcp.ack: true
      tcp.fin: true
      tcp.psh: true
      tcp.state: closed
      tcp.syn: true
      tcp.tcp_flags: 1b
      tcp.tcp_flags_tc: 1b
      tcp.tcp_flags_ts: 1b
- filter:
    count: 1
    match:
      app_proto: pgsql
      dest_ip: 10.16.1.11
      dest_port: 5432
      event_type: flow
      flow.age: 9
      flow.alerted: false
      flow.bytes_toclient: 2717
      flow.bytes_toserver: 1180
      flow.pkts_toclient: 12
      flow.pkts_toserver: 15
      flow.reason: shutdown
      flow.state: closed
      proto: TCP
      src_ip: 10.16.1.10
      src_port: 40816
      tcp.ack: true
      tcp.fin: true
      tcp.psh: true
      tcp.state: closed
      tcp.syn: true
      tcp.tcp_flags: 1b
      tcp.tcp_flags_tc: 1b
      tcp.tcp_flags_ts: 1b
