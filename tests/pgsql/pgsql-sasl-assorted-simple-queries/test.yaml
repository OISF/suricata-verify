requires:
# Pgsql was released on version 7.0
  min-version: 7.0

args:
- -k none

checks:
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 6
      pgsql.request.message: SSL Request
      pgsql.response.message: SSL Rejected
      pgsql.tx_id: 1
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 9
      pgsql.request.startup_message.protocol_version: '3.0'
      pgsql.request.startup_message.startup_parameters.database: Test
      pgsql.request.startup_message.startup_parameters.user: ju-Test
      pgsql.response.message: authentication_sasl
      pgsql.tx_id: 2
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 12
      pgsql.request.sasl_initial_response.authentication_mechanism: scram_SHA256
      pgsql.request.sasl_initial_response.sasl_param: n,,n=,r=CW740WBxLZZB5YJevR4r9gOK
      pgsql.response.message: authentication_sasl_continue
      pgsql.tx_id: 3
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 15
      pgsql.request.sasl_response.payload: c=biws,r=CW740WBxLZZB5YJevR4r9gOKZZKXrTf56ImeOAD0wW/PBe/u,p=vv0eiWYw+MiL3GdM8/y6NWyTTXTk1FSNCW9aSlfHkiE=
      pgsql.responses[0].authentication_sasl_final: v=PcOGJHfx1UfVwvtWa3Faz/dRqWUeUJazljwi6oeapl4=
      pgsql.responses[10].parameter_status.name: session_authorization
      pgsql.responses[10].parameter_status.value: ju-Test
      pgsql.responses[11].parameter_status.name: standard_conforming_strings
      pgsql.responses[11].parameter_status.value: 'on'
      pgsql.responses[12].parameter_status.name: TimeZone
      pgsql.responses[12].parameter_status.value: Europe/London
      pgsql.responses[13].backend_key_data.process_id: 10804
      pgsql.responses[13].backend_key_data.secret_key: 1115740663
      pgsql.responses[14].ready_for_query.transaction_status: I
      pgsql.responses[1].message: authentication_ok
      pgsql.responses[2].parameter_status.name: application_name
      pgsql.responses[2].parameter_status.value: psql
      pgsql.responses[3].parameter_status.name: client_encoding
      pgsql.responses[3].parameter_status.value: UTF8
      pgsql.responses[4].parameter_status.name: DateStyle
      pgsql.responses[4].parameter_status.value: ISO, DMY
      pgsql.responses[5].parameter_status.name: integer_datetimes
      pgsql.responses[5].parameter_status.value: 'on'
      pgsql.responses[6].parameter_status.name: IntervalStyle
      pgsql.responses[6].parameter_status.value: postgres
      pgsql.responses[7].parameter_status.name: is_superuser
      pgsql.responses[7].parameter_status.value: 'on'
      pgsql.responses[8].parameter_status.name: server_encoding
      pgsql.responses[8].parameter_status.value: UTF8
      pgsql.responses[9].parameter_status.name: server_version
      pgsql.responses[9].parameter_status.value: '13.4'
      pgsql.tx_id: 4
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 18
      pgsql.request.simple_query: create table dummy_table(name varchar(20), address
        text, age int);
      pgsql.responses[0].command_completed: CREATE TABLE
      pgsql.responses[1].ready_for_query.transaction_status: I
      pgsql.tx_id: 5
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 23
      pgsql.request.simple_query: insert into dummy_table("Juliana", "location-A",
        25);
      pgsql.responses[0].error_response.message_body.code: '42601'
      pgsql.responses[0].error_response.message_body.file: scan.l
      pgsql.responses[0].error_response.message_body.line: '1180'
      pgsql.responses[0].error_response.message_body.message: syntax error at or near
        "25"
      pgsql.responses[0].error_response.message_body.position: '50'
      pgsql.responses[0].error_response.message_body.routine: scanner_yyerror
      pgsql.responses[0].error_response.message_body.severity_localizable: ERROR
      pgsql.responses[0].error_response.message_body.severity_non_localizable: ERROR
      pgsql.responses[1].ready_for_query.transaction_status: I
      pgsql.tx_id: 6
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 28
      pgsql.request.simple_query: insert into dummy_table('Juliana','location-A',25);
      pgsql.responses[0].error_response.message_body.code: '42601'
      pgsql.responses[0].error_response.message_body.file: scan.l
      pgsql.responses[0].error_response.message_body.line: '1180'
      pgsql.responses[0].error_response.message_body.message: syntax error at or near
        "'Juliana'"
      pgsql.responses[0].error_response.message_body.position: '25'
      pgsql.responses[0].error_response.message_body.routine: scanner_yyerror
      pgsql.responses[0].error_response.message_body.severity_localizable: ERROR
      pgsql.responses[0].error_response.message_body.severity_non_localizable: ERROR
      pgsql.responses[1].ready_for_query.transaction_status: I
      pgsql.tx_id: 7
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 33
      pgsql.request.simple_query: insert into dummy_table values("Juliana", "location-A",
        25);
      pgsql.responses[0].error_response.message_body.code: '42703'
      pgsql.responses[0].error_response.message_body.file: d:\pginstaller_13.auto\postgres.windows-x64\src\backend\parser\parse_relation.c
      pgsql.responses[0].error_response.message_body.line: '3514'
      pgsql.responses[0].error_response.message_body.message: column "Juliana" does
        not exist
      pgsql.responses[0].error_response.message_body.position: '32'
      pgsql.responses[0].error_response.message_body.routine: errorMissingColumn
      pgsql.responses[0].error_response.message_body.severity_localizable: ERROR
      pgsql.responses[0].error_response.message_body.severity_non_localizable: ERROR
      pgsql.responses[1].ready_for_query.transaction_status: I
      pgsql.tx_id: 8
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 36
      pgsql.request.simple_query: insert into dummy_table values('Juliana', 'location-A',
        25);
      pgsql.responses[0].command_completed: INSERT 0 1
      pgsql.responses[1].ready_for_query.transaction_status: I
      pgsql.tx_id: 9
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 39
      pgsql.request.simple_query: insert into dummy_table values('Harry', 'location-B',
        12);
      pgsql.responses[0].command_completed: INSERT 0 1
      pgsql.responses[1].ready_for_query.transaction_status: I
      pgsql.tx_id: 10
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 42
      pgsql.request.simple_query: insert into dummy_table values('Hermione', 'location-C',
        12);
      pgsql.responses[0].command_completed: INSERT 0 1
      pgsql.responses[1].ready_for_query.transaction_status: I
      pgsql.tx_id: 11
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 47
      pgsql.request.simple_query: update dummy_table set name='Ron', age=12 where
        name='Juliana');
      pgsql.responses[0].error_response.message_body.code: '42601'
      pgsql.responses[0].error_response.message_body.file: scan.l
      pgsql.responses[0].error_response.message_body.line: '1180'
      pgsql.responses[0].error_response.message_body.message: syntax error at or near
        ")"
      pgsql.responses[0].error_response.message_body.position: '63'
      pgsql.responses[0].error_response.message_body.routine: scanner_yyerror
      pgsql.responses[0].error_response.message_body.severity_localizable: ERROR
      pgsql.responses[0].error_response.message_body.severity_non_localizable: ERROR
      pgsql.responses[1].ready_for_query.transaction_status: I
      pgsql.tx_id: 12
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 50
      pgsql.request.simple_query: update dummy_table set name='Ron', age=12 where
        name='Juliana';
      pgsql.responses[0].command_completed: UPDATE 1
      pgsql.responses[1].ready_for_query.transaction_status: I
      pgsql.tx_id: 13
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: pgsql
      pcap_cnt: 53
      pgsql.request.simple_query: select * from dummy_table;
      pgsql.responses[0].row_description.backend_response: Response Ok
      pgsql.responses[0].row_description.field_count: 3
      pgsql.responses[1].data_row.backend_response: Response Ok
      pgsql.responses[2].data_row.backend_response: Response Ok
      pgsql.responses[3].data_row.backend_response: Response Ok
      pgsql.responses[4].command_completed: SELECT 3
      pgsql.responses[5].ready_for_query.transaction_status: I
      pgsql.tx_id: 14
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
- filter:
    count: 1
    match:
      app_proto: pgsql
      dest_ip: 192.168.1.74
      dest_port: 5432
      event_type: flow
      flow.age: 679
      flow.alerted: false
      flow.bytes_toclient: 2340
      flow.bytes_toserver: 2729
      flow.pkts_toclient: 19
      flow.pkts_toserver: 34
      flow.reason: shutdown
      flow.state: established
      proto: TCP
      src_ip: 192.168.1.102
      src_port: 41678
      tcp.ack: true
      tcp.psh: true
      tcp.state: established
      tcp.syn: true
      tcp.tcp_flags: 1a
      tcp.tcp_flags_tc: 1a
      tcp.tcp_flags_ts: 1a
