requires:
  min-version: 8

checks:

  - filter:
      filename: all.json
      count: 14
      match:
        event_type: "dns"

  # Check that we only have requests and responses for A records.
  - filter:
      filename: only-a.json
      count: 4
      match:
        event_type: "dns"

  # 2 should be DNS requests
  - filter:
      filename: only-a.json
      count: 2
      match:
        event_type: "dns"
        dns.queries[0].rrtype: "A"

  # 2 should be DNS responses
  - filter:
      filename: only-a.json
      count: 2
      match:
        event_type: "dns"
        dns.answers[1].rrtype: "A"

  # Also check that the source and destination addresses and ports are
  # as expected.
  - filter:
      filename: only-a.json
      count: 1
      match:
        pcap_cnt: 1
        src_ip: "10.16.1.11"
        src_port: 54888
        dest_ip: "8.8.8.8"
        dest_port: 53
        dns.type: "request"
  - filter:
      filename: only-a.json
      count: 1
      match:
        pcap_cnt: 2
        src_ip: "10.16.1.11"
        src_port: 54888
        dest_ip: "8.8.8.8"
        dest_port: 53
        dns.type: "answer"

  # Check that we only have A and AAAA requests.
  - filter:
      filename: a-and-aaaa-requests-only.json
      count: 4
      match:
        event_type: "dns"
  - filter:
      filename: a-and-aaaa-requests-only.json
      count: 2
      match:
        event_type: "dns"
        dns.queries[0].rrtype: "A"
  - filter:
      filename: a-and-aaaa-requests-only.json
      count: 2
      match:
        event_type: "dns"
        dns.queries[0].rrtype: "AAAA"
  - filter:
      filename: a-and-aaaa-requests-only.json
      count: 4
      match:
        event_type: "dns"
        dns.type: "request"

  # Check that we only have 3 log entries, and that they are all MX
  # responses.
  - filter:
      filename: mx-responses-only.json
      count: 3
      match:
        event_type: "dns"
  - filter:
      filename: mx-responses-only.json
      count: 3
      match:
        event_type: "dns"
        dns.type: "answer"
  - filter:
      filename: mx-responses-only.json
      count: 3
      match:
        event_type: "dns"
        dns.rrtype: "MX"
